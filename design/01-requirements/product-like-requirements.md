# API 요구사항 명세서

## 📦 범위: 상품 좋아요

---

## 📊 개념 모델

### 액터 (Actor)

| 액터 | 설명 |
|------|------|
| **회원 (User)** | 로그인한 사용자, 좋아요 기능 사용 가능 |

### 핵심 도메인 (Core Domain)

| 도메인 | 책임 |
|--------|------|
| **상품 (Product)** | 상품 정보 관리 |
| **좋아요 (Like)** | 회원-상품 간 좋아요 관계 관리 |

### 엔티티 관계도

```
┌─────────┐  N    1  ┌─────────┐
│  Like   │ ───────▶ │ Product │
└─────────┘          └─────────┘
     │
     │ N
     ▼
┌─────────┐
│  User   │
└─────────┘
```

---

## 📖 유저 스토리 (User Stories)

### 상품 좋아요 등록

| ID | 역할 | 스토리 |
|----|------|--------|
| US-L01 | 회원 | 상품에 좋아요를 등록한다 |
| US-L02 | 회원 | 존재하지 않는 상품에 좋아요 시 404 에러를 반환받는다 |
| US-L03 | 회원 | 이미 좋아요한 상품에 다시 좋아요해도 정상 처리된다 (멱등성) |

### 상품 좋아요 취소

| ID | 역할 | 스토리 |
|----|------|--------|
| US-L04 | 회원 | 상품에 좋아요를 취소한다 |
| US-L05 | 회원 | 존재하지 않는 상품에 좋아요 취소 시 404 에러를 반환받는다 |
| US-L06 | 회원 | 이미 좋아요 취소한 상품에 다시 좋아요 취소해도 정상 처리된다 (멱등성) |

### 좋아요 상품 목록 조회

| ID | 역할 | 스토리 |
|----|------|--------|
| US-L07 | 회원 | 내가 좋아요한 상품 목록을 조회한다 |
| US-L08 | 회원 | 좋아요한 상품 목록을 페이징하여 조회한다 |
| US-L09 | 회원 | 페이지당 조회 개수를 20/50/100개로 변경하여 조회한다 |

---

## 📚 도메인 용어 정의

| 용어 | 영문 | 정의 |
|------|------|------|
| 상품 | Product | 브랜드가 판매하는 개별 아이템. 하나의 브랜드에만 속한다 |
| 좋아요 | Like | 사용자가 상품에 대해 표시하는 관심 표현. 사용자당 상품별 1회만 가능하다 |
| 멱등성 | Idempotency | 동일한 요청을 여러 번 수행해도 결과가 동일한 것을 보장하는 특성 |

---

## 🔄 기능 흐름 (Feature Flow)

### 1. 상품 좋아요 등록 흐름

```
[User] ──POST /api/v1/products/{productId}/likes──▶ [Server]
                                                        │
                                                        ▼
                                                  사용자 인증 검증
                                                  (X-Loopers-LoginId, X-Loopers-LoginPw)
                                                        │
                                      ┌─────────────────┴─────────────────┐
                                      ▼                                   ▼
                                인증 성공                             인증 실패
                                      │                                   │
                                      ▼                                   ▼
                              productId 유효성 검증                  401 Unauthorized
                                      │
                      ┌───────────────┴───────────────┐
                      ▼                               ▼
                상품 존재                         상품 미존재
                      │                               │
                      ▼                               ▼
              기존 좋아요 여부 확인              404 Not Found
                      │
          ┌───────────┴───────────┐
          ▼                       ▼
    이미 좋아요 존재          좋아요 미존재
          │                       │
          ▼                       ▼
   200 OK (멱등성 보장)      좋아요 등록
                                  │
                                  ▼
                            200 OK 반환
```

### 2. 상품 좋아요 취소 흐름

```
[User] ──DELETE /api/v1/products/{productId}/likes──▶ [Server]
                                                          │
                                                          ▼
                                                    사용자 인증 검증
                                                    (X-Loopers-LoginId, X-Loopers-LoginPw)
                                                          │
                                        ┌─────────────────┴─────────────────┐
                                        ▼                                   ▼
                                  인증 성공                             인증 실패
                                        │                                   │
                                        ▼                                   ▼
                                productId 유효성 검증                  401 Unauthorized
                                        │
                        ┌───────────────┴───────────────┐
                        ▼                               ▼
                  상품 존재                         상품 미존재
                        │                               │
                        ▼                               ▼
                기존 좋아요 여부 확인              404 Not Found
                        │
            ┌───────────┴───────────┐
            ▼                       ▼
      좋아요 존재              좋아요 미존재
            │                       │
            ▼                       ▼
      좋아요 삭제           200 OK (멱등성 보장)
            │
            ▼
      200 OK 반환
```

### 3. 좋아요 상품 목록 조회 흐름

```
[User] ──GET /api/v1/users/{userId}/likes?page=0&size=20──▶ [Server]
                                                                │
                                                                ▼
                                                          사용자 인증 검증
                                                          (X-Loopers-LoginId, X-Loopers-LoginPw)
                                                                │
                                              ┌─────────────────┴─────────────────┐
                                              ▼                                   ▼
                                        인증 성공                             인증 실패
                                              │                                   │
                                              ▼                                   ▼
                                    요청 파라미터 파싱                      401 Unauthorized
                                              │
                                              ▼
                                    size 값 검증 (20/50/100)
                                              │
                                              ▼
                                    좋아요 상품 목록 조회
                                              │
                                              ▼
                                        페이징 처리
                                              │
                                              ▼
                          200 OK + 상품 목록 (페이징 정보 포함) 반환
```

---

## 1. 상품 좋아요 등록 API

### 목표
상품 좋아요 등록 API를 개발한다

### 기본 정보

| 항목 | 내용 |
|------|------|
| Method | `POST` |
| Endpoint | `/api/v1/products/{productId}/likes` |
| 인증 | 필요 |

### 요구사항
- 상품에 좋아요를 등록한다
- 사용자 인증이 있어야만 가능하다
- 인증은 아래 헤더를 통해 가능하다
  - `X-Loopers-LoginId`: 로그인 ID
  - `X-Loopers-LoginPw`: 비밀번호

### 제한사항
- 존재하지 않는 상품 ID로 좋아요 시 `404 Not Found` 에러를 반환한다
- 이미 좋아요한 상품에 대해 다시 좋아요 시 멱등성을 보장한다

### 응답 예시
```json
{
  "productId": 1,
  "liked": true,
  "likedAt": "2026-02-13T12:30:00"
}
```

---

## 2. 상품 좋아요 취소 API

### 목표
상품 좋아요 취소 API를 개발한다

### 기본 정보

| 항목 | 내용 |
|------|------|
| Method | `DELETE` |
| Endpoint | `/api/v1/products/{productId}/likes` |
| 인증 | 필요 |

### 요구사항
- 상품에 좋아요를 취소한다
- 사용자 인증이 있어야만 가능하다
- 인증은 아래 헤더를 통해 가능하다
  - `X-Loopers-LoginId`: 로그인 ID
  - `X-Loopers-LoginPw`: 비밀번호

### 제한사항
- 존재하지 않는 상품 ID로 좋아요 취소 시 `404 Not Found` 에러를 반환한다
- 이미 좋아요 취소한 상품에 대해 다시 좋아요 취소 시 멱등성을 보장한다

### 응답 예시
```json
{
  "productId": 1,
  "liked": false
}
```

---

## 3. 내가 좋아요한 상품 목록 조회 API

### 목표
내가 좋아요한 상품 목록을 조회하는 API를 개발한다

### 기본 정보

| 항목 | 내용 |
|------|------|
| Method | `GET` |
| Endpoint | `/api/v1/users/{userId}/likes` |
| 인증 | 필요 |

### 요구사항

#### 인증
- 사용자 인증이 있어야만 가능하다
- 인증은 아래 헤더를 통해 가능하다
  - `X-Loopers-LoginId`: 로그인 ID
  - `X-Loopers-LoginPw`: 비밀번호

#### 페이징
- 좋아요한 상품 목록은 페이징 처리가 되어야 한다
- 페이지당 조회 개수: **기본 20개**, 변경 가능 (50, 100개)

### 요청 파라미터

| 파라미터 | 타입 | 필수 | 기본값 | 설명 |
|---------|------|------|-------|------|
| page | Integer | N | 0 | 페이지 번호 |
| size | Integer | N | 20 | 페이지당 조회 개수 (20, 50, 100) |

### 응답 예시
```json
{
  "content": [
    {
      "productId": 1,
      "name": "상품명",
      "price": 10000,
      "status": "ACTIVE",
      "likeCount": 150,
      "brand": {
        "brandId": 1,
        "name": "브랜드명"
      },
      "likedAt": "2026-02-13T12:30:00"
    }
  ],
  "page": 0,
  "size": 20,
  "totalElements": 100,
  "totalPages": 5
}
```
