# API 요구사항 명세서

## 📦 범위: 주문

---

## 📊 개념 모델

### 액터 (Actor)

| 액터 | 설명 |
|------|------|
| **회원 (User)** | 로그인한 사용자, 주문 기능 사용 가능 |

### 핵심 도메인 (Core Domain)

| 도메인 | 책임 |
|--------|------|
| **상품 (Product)** | 상품 정보 관리, 재고 관리 |
| **주문 (Order)** | 주문 정보 관리, 주문 항목 관리 |
| **주문 항목 (Order Item)** | 주문에 포함된 개별 상품 및 수량 관리, 상품 스냅샷 저장 |

### 엔티티 관계도

```
┌─────────┐  1    N  ┌─────────────┐  N    1  ┌─────────┐
│  Order  │ ◀─────── │ Order Item  │ ───────▶ │ Product │
└─────────┘          └─────────────┘          └─────────┘
     │
     │ N
     ▼
┌─────────┐
│  User   │
└─────────┘
```

### 주문 프로세스

```
┌──────────────┐
│  주문 요청   │
└──────┬───────┘
       │
       ▼
┌──────────────┐
│  재고 확인   │
└──────┬───────┘
       │
   ┌───┴───┐
   ▼       ▼
 충분    부족
   │       │
   ▼       ▼
┌──────┐ ┌──────┐
│차감  │ │ 409  │
└──┬───┘ └──────┘
   │
   ▼
┌──────────────┐
│스냅샷 저장   │
└──────┬───────┘
       │
       ▼
┌──────────────┐
│  주문 생성   │
└──────────────┘
```

---

## 📖 유저 스토리 (User Stories)

### 주문 요청

| ID | 역할 | 스토리 |
|----|------|--------|
| US-O01 | 회원 | 상품을 주문한다 |
| US-O02 | 회원 | 여러 상품을 상품별 수량을 지정하여 주문한다 |
| US-O03 | 회원 | 재고가 부족한 상품 주문 시 409 에러를 반환받는다 |
| US-O04 | 회원 | 주문 시 주문 당시 상품 정보가 스냅샷으로 저장된다 |

### 주문 목록 조회

| ID | 역할 | 스토리 |
|----|------|--------|
| US-O05 | 회원 | 내 주문 목록을 조회한다 |
| US-O06 | 회원 | 기간 범위를 지정하여 주문 목록을 조회한다 |

### 주문 상세 조회

| ID | 역할 | 스토리 |
|----|------|--------|
| US-O07 | 회원 | 주문 ID로 주문 상세 정보를 조회한다 |

---

## 📚 도메인 용어 정의

| 용어 | 영문 | 정의 |
|------|------|------|
| 상품 | Product | 브랜드가 판매하는 개별 아이템. 하나의 브랜드에만 속한다 |
| 주문 | Order | 사용자가 상품을 구매하기 위해 요청하는 행위 |
| 주문 항목 | Order Item | 주문에 포함된 개별 상품과 수량 정보 |
| 재고 | Stock | 상품의 판매 가능한 수량 |
| 스냅샷 | Snapshot | 주문 당시 상품의 정보를 저장한 데이터 |

---

## 🔄 기능 흐름 (Feature Flow)

### 1. 주문 요청 흐름

```
[User] ──POST /api/v1/orders──▶ [Server]
                                    │
                                    ▼
                              사용자 인증 검증
                              (X-Loopers-LoginId, X-Loopers-LoginPw)
                                    │
                  ┌─────────────────┴─────────────────┐
                  ▼                                   ▼
            인증 성공                             인증 실패
                  │                                   │
                  ▼                                   ▼
          주문 상품 목록 검증                    401 Unauthorized
                  │
                  ▼
          상품별 재고 확인
                  │
      ┌───────────┴───────────┐
      ▼                       ▼
  재고 충분                재고 부족
      │                       │
      ▼                       ▼
  재고 차감              409 Conflict
      │
      ▼
  상품 정보 스냅샷 저장
      │
      ▼
  주문 생성
      │
      ▼
  200 OK + 주문 정보 반환
```

### 2. 주문 목록 조회 흐름

```
[User] ──GET /api/v1/orders?startAt=2026-01-31&endAt=2026-02-10──▶ [Server]
                                                                       │
                                                                       ▼
                                                                 사용자 인증 검증
                                                                 (X-Loopers-LoginId, X-Loopers-LoginPw)
                                                                       │
                                                     ┌─────────────────┴─────────────────┐
                                                     ▼                                   ▼
                                               인증 성공                             인증 실패
                                                     │                                   │
                                                     ▼                                   ▼
                                           요청 파라미터 파싱                      401 Unauthorized
                                                     │
                                                     ▼
                                           기간 범위 검증
                                                     │
                                                     ▼
                                           주문 목록 조회
                                                     │
                                                     ▼
                                     200 OK + 주문 목록 반환
```

### 3. 주문 상세 조회 흐름

```
[User] ──GET /api/v1/orders/{orderId}──▶ [Server]
                                              │
                                              ▼
                                        사용자 인증 검증
                                        (X-Loopers-LoginId, X-Loopers-LoginPw)
                                              │
                            ┌─────────────────┴─────────────────┐
                            ▼                                   ▼
                      인증 성공                             인증 실패
                            │                                   │
                            ▼                                   ▼
                    orderId 유효성 검증                    401 Unauthorized
                            │
            ┌───────────────┴───────────────┐
            ▼                               ▼
        주문 존재                       주문 미존재
            │                               │
            ▼                               ▼
      주문 상세 조회                   404 Not Found
            │
            ▼
  200 OK + 주문 상세 정보 반환
```

---

## 1. 주문 요청 API

### 목표
주문 요청 API를 개발한다

### 기본 정보

| 항목 | 내용 |
|------|------|
| Method | `POST` |
| Endpoint | `/api/v1/orders` |
| 인증 | 필요 |

### 요구사항
- 주문 요청을 한다
- 사용자 인증이 있어야만 가능하다
- 인증은 아래 헤더를 통해 가능하다
  - `X-Loopers-LoginId`: 로그인 ID
  - `X-Loopers-LoginPw`: 비밀번호
- 주문은 여러 상품으로 상품별 수량을 조절해서 넘길 수 있다
- 주문 시에는 상품의 재고를 확인하고 차감한다
- 주문 시 주문 당시 상품에 대한 정보를 스냅샷으로 저장해야 한다

### 제한사항
- 재고가 부족하면 재고부족으로 주문이 실패하고 `409 Conflict` 에러를 반환한다

### 요청 예시
```json
{
  "orderItems": [
    {
      "productId": 1,
      "quantity": 2
    },
    {
      "productId": 2,
      "quantity": 1
    }
  ]
}
```

### 응답 예시
```json
{
  "orderId": 1,
  "orderItems": [
    {
      "productId": 1,
      "productName": "상품명1",
      "price": 10000,
      "quantity": 2,
      "subtotal": 20000
    },
    {
      "productId": 2,
      "productName": "상품명2",
      "price": 5000,
      "quantity": 1,
      "subtotal": 5000
    }
  ],
  "totalAmount": 25000,
  "orderedAt": "2026-02-13T12:30:00"
}
```

---

## 2. 주문 목록 조회 API

### 목표
사용자의 주문 목록을 조회하는 API를 개발한다

### 기본 정보

| 항목 | 내용 |
|------|------|
| Method | `GET` |
| Endpoint | `/api/v1/orders` |
| 인증 | 필요 |

### 요구사항
- 사용자의 주문 목록을 조회한다
- 사용자 인증이 있어야만 가능하다
- 인증은 아래 헤더를 통해 가능하다
  - `X-Loopers-LoginId`: 로그인 ID
  - `X-Loopers-LoginPw`: 비밀번호
- 조회는 기간 범위 내에 데이터를 조회한다

### 요청 파라미터

| 파라미터 | 타입 | 필수 | 기본값 | 설명 |
|---------|------|------|-------|------|
| startAt | Date | Y | - | 조회 시작일 (yyyy-MM-dd) |
| endAt | Date | Y | - | 조회 종료일 (yyyy-MM-dd) |

### 응답 예시
```json
{
  "orders": [
    {
      "orderId": 1,
      "totalAmount": 25000,
      "itemCount": 3,
      "orderedAt": "2026-02-13T12:30:00"
    },
    {
      "orderId": 2,
      "totalAmount": 15000,
      "itemCount": 1,
      "orderedAt": "2026-02-10T10:00:00"
    }
  ]
}
```

---

## 3. 주문 상세 조회 API

### 목표
사용자의 단일 주문 상세를 조회하는 API를 개발한다

### 기본 정보

| 항목 | 내용 |
|------|------|
| Method | `GET` |
| Endpoint | `/api/v1/orders/{orderId}` |
| 인증 | 필요 |

### 요구사항
- 사용자의 주문 상세를 조회한다
- 사용자 인증이 있어야만 가능하다
- 인증은 아래 헤더를 통해 가능하다
  - `X-Loopers-LoginId`: 로그인 ID
  - `X-Loopers-LoginPw`: 비밀번호

### 제한사항
- 존재하지 않는 주문 ID로 조회 시 `404 Not Found` 에러를 반환한다

### 응답 예시
```json
{
  "orderId": 1,
  "orderItems": [
    {
      "productId": 1,
      "productName": "상품명1",
      "price": 10000,
      "quantity": 2,
      "subtotal": 20000
    },
    {
      "productId": 2,
      "productName": "상품명2",
      "price": 5000,
      "quantity": 1,
      "subtotal": 5000
    }
  ],
  "totalAmount": 25000,
  "orderedAt": "2026-02-13T12:30:00"
}
```
