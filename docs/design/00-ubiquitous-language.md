# 유비쿼터스 언어 (Ubiquitous Language)

본 문서는 서비스의 이해관계자(기획, 개발, 디자인 등)가 동일한 문맥으로 소통하기 위해 정의한 공통 용어 사전입니다.
해당 프로젝트의 모든 문서와 산출물은 본 용어 정의를 기준으로 작성합니다.

## 1. 역할 (Actors)

- **Customer**: 브랜드/상품을 탐색하고 좋아요, 주문을 수행하는 구매 주체입니다.
- **Admin**: 브랜드/상품/주문을 운영 및 관리하는 주체입니다.

## 2. 핵심 도메인 용어 (Core Domains)

- **브랜드 (Brand)**: 상품을 공급하고 정체성을 표현하는 주체입니다.
- **상품 (Product)**: 브랜드에 속한 판매 단위입니다.
- **SKU (Stock Keeping Unit)**: 재고 관리를 위한 최소 식별 단위입니다.
    - 본 서비스에서는 옵션이 없는 단일 판매 단위만 다루므로, SKU는 상품과 1:1로 대응합니다.
- **재고 (Stock)**: SKU의 구매 가능한 수량이며, `product_stock`에서 관리합니다.
- **장바구니 (Cart)**: 주문 생성 전, Customer가 구매 예정 항목들을 구성해 두는 임시 공간입니다.
    - 현재 요구사항 구현 범위에서는 제외되며, 후속 확장 도메인으로 다룹니다.
- **장바구니 항목 (CartItem)**: 장바구니를 구성하는 개별 항목입니다.
    - 구성 요소: 상품(SKU), 수량
    - 현재 요구사항 구현 범위에서는 제외되며, 후속 확장 도메인으로 다룹니다.
- **주문 (Order)**: 주문 요청(items)으로 전달된 상품/수량 조합으로 생성된 구매 기록입니다.
- **주문 항목 (OrderItem)**: 주문을 구성하는 개별 항목입니다.
    - 구성 요소: 상품, 주문 수량, 주문 시점의 스냅샷 정보(아래 3.3 참조)
- **좋아요 (Like)**: Customer가 특정 상품에 대해 선호를 표시하고 저장하는 행위 및 데이터입니다.

## 3. 상태 및 비즈니스 정책 (Status & Policies)

### 3.1 노출/구매 가능

- **노출 (Visible)**: Customer가 목록/상세에서 확인할 수 있는 상태를 의미합니다.
- **구매 가능 (Purchasable)**: Customer가 주문 생성을 진행할 수 있는 상태를 의미합니다.

- **활성 (Active) / 비활성 (Inactive)**: Admin이 관리하는 브랜드/상품의 운영 상태를 의미합니다.
    - 일반적으로 비활성인 대상은 Customer에게 노출되지 않습니다.

### 3.2 주문 생성 관련 용어

- **주문 생성 (Order Creation)**: API 요청 `items[{productId, quantity}]`를 기반으로 주문을 생성하여 기록하는 행위입니다.

- **생성됨(CREATED)**: 주문이 생성되어 시스템에 기록된 상태를 의미합니다.
    - 본 범위에서는 결제를 다루지 않으므로, Created가 “주문 흐름의 최종 상태”입니다.
    - 결제 도입 시점에 결제 완료를 나타내는 별도의 용어/상태(예: Paid)를 추가합니다.

- **재고 유효성 검증 (Stock Validation)**: 주문 생성 직전에, 주문 대상 모든 SKU에 대해 “요청 수량만큼 구매 가능” 여부를 확인하는 절차입니다.
    - 검증과 차감은 `product_stock`의 가용 재고를 기준으로 수행합니다.

- **전부 성공 또는 전부 실패 (All-or-Nothing)**: 주문 내 모든 상품의 재고가 확보 가능해야만 주문이 생성되는 원칙입니다.
    - 하나라도 부족하면 주문은 생성되지 않습니다.

- **자동 보정 (Auto-Correction)**: 재고 부족 시 수량을 구매 가능 최대치로 보정하는 처리 개념입니다.
    - 현재 요구사항 구현 범위에서는 미적용합니다.
    - 현재 범위에서는 재고 부족 시 주문은 전체 실패합니다.

### 3.3 주문 스냅샷

- **주문 스냅샷 (Order Snapshot)**: 주문 생성 시점의 정보를 주문 항목에 영구 보존하는 것을 의미합니다.
    - 포함 항목(현재 범위): `productId`, `productName`, `brandId`, `brandName`, `unitPrice`, `orderedQuantity`

### 3.4 데이터 유지 정책(개념)

- **논리 삭제 (Logical Delete)**: 데이터를 물리적으로 제거하지 않고, 상태 변경을 통해 노출/구매를 차단하는 방식입니다.

### 3.5 중복 주문 방지(개념)

- **멱등성 (Idempotency)**: 동일한 주문 생성 요청이 여러 번 들어오더라도 결과가 “주문 1건만 생성”으로 유지되는 성질입니다.
    - 중복 주문 방지의 원칙을 의미합니다.
    - 주문 생성 API에서는 `Idempotency-Key` 헤더를 사용해 멱등성을 보장합니다.
    - 동일 사용자/동일 키에서 요청 본문이 다르면 요청 오류로 처리합니다.
