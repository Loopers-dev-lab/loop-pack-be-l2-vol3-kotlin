# DEC-005: 주문 멱등성 보장 방식

| 항목 | 내용 |
|------|------|
| **상태** | OPEN |
| **관련 도메인** | Orders |
| **관련 요구사항** | UC-O01 주문 요청 |

## 기능적 요구사항

네트워크 재시도 등으로 같은 주문이 중복 생성되지 않아야 한다.

## 미결정 사항

| 선택지 | 설명 | 장점 | 단점 |
|--------|------|------|------|
| **멱등키 (Idempotency Key)** | 클라이언트가 요청 헤더에 고유 키를 포함 | 업계 표준(Stripe 등), 명확한 의미론 | 클라이언트 구현 필요, 키 저장/만료 관리 |
| **클라이언트 UUID** | 클라이언트가 주문 ID를 사전 생성하여 전달 | 간단한 구현 | UUID 충돌 가능성(극히 낮음), 클라이언트 의존 |
| **서버사이드 중복 탐지** | 동일 사용자+동일 상품+시간 범위로 중복 판별 | 클라이언트 변경 불필요 | 판별 기준 모호, 의도적 재주문과 구분 어려움 |

## 진짜 필요한 것

클라이언트 재시도 시에도 **단일 주문만 생성**되는 보장. 동시에 사용자 경험을 해치지 않는 중복 방지.

핵심 질문:
- 초기 버전에서 멱등성이 반드시 필요한가, 아니면 추후 도입 가능한가?
- 클라이언트(프론트엔드) 측에서 멱등키 생성을 지원할 수 있는가?
- 멱등키의 유효 기간(TTL)은 얼마로 설정할 것인가?

## 변경 가능성

- 결제 연동 시 결제사의 멱등성 요구사항과 맞춰야 할 수 있음
- 결제 시스템이 자체적으로 멱등성을 보장하면 주문 레벨의 멱등성 전략이 달라질 수 있음

## 참고

- 프로젝트 설계 시 고려사항: "네트워크 재시도 등으로 같은 주문이 중복 생성될 수 있다"
- 업계 참고: Stripe Idempotency Key, Toss Payments 멱등키
