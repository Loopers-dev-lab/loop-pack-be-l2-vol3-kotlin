# 주문(Orders) API 스펙

주문 요구사항 문서(`docs/주문/01-requirements.md`) 작성 시 참고하는 API 명세입니다.
모든 주문 API는 로그인이 필요합니다(`X-Loopers-LoginId`, `X-Loopers-LoginPw` 헤더 필수).

## API 엔드포인트 목록

| METHOD | URI | 인증 필요 | 설명 |
|--------|-----|-----------|------|
| POST | `/api/v1/orders` | O | 주문 요청 |
| GET | `/api/v1/orders?startAt={날짜}&endAt={날짜}` | O | 유저의 주문 목록 조회 |
| GET | `/api/v1/orders/{orderId}` | O | 단일 주문 상세 조회 |

## 상세 스펙

### 1. 주문 요청

- **METHOD**: `POST`
- **URI**: `/api/v1/orders`
- **인증 필요**: O (`X-Loopers-LoginId`, `X-Loopers-LoginPw` 헤더 필수)
- **설명**: 여러 상품을 한 번에 주문합니다. 주문 항목별로 상품 ID와 수량을 지정합니다.

#### 요청 예시

```json
{
  "items": [
    { "productId": 1, "quantity": 2 },
    { "productId": 3, "quantity": 1 }
  ]
}
```

### 2. 주문 목록 조회

- **METHOD**: `GET`
- **URI**: `/api/v1/orders`
- **인증 필요**: O (`X-Loopers-LoginId`, `X-Loopers-LoginPw` 헤더 필수)
- **설명**: 로그인한 사용자의 주문 목록을 기간별로 조회합니다. 본인의 주문만 조회 가능합니다.

#### 쿼리 파라미터

| 파라미터 | 타입 | 필수 여부 | 예시 | 설명 |
|----------|------|-----------|------|------|
| `startAt` | LocalDate | O | `2026-01-31` | 조회 시작일 |
| `endAt` | LocalDate | O | `2026-02-10` | 조회 종료일 |

#### 요청 예시

```http
GET /api/v1/orders?startAt=2026-01-31&endAt=2026-02-10
X-Loopers-LoginId: testuser01
X-Loopers-LoginPw: password123!
```

### 3. 단일 주문 상세 조회

- **METHOD**: `GET`
- **URI**: `/api/v1/orders/{orderId}`
- **인증 필요**: O (`X-Loopers-LoginId`, `X-Loopers-LoginPw` 헤더 필수)
- **설명**: 특정 주문의 상세 내역을 조회합니다. 본인의 주문만 조회 가능합니다.

## 핵심 비즈니스 규칙

### 상품 정보 스냅샷

주문 정보에는 주문 당시의 상품 정보가 스냅샷으로 저장되어야 합니다.
이후 상품 정보(가격, 상품명 등)가 변경되더라도 주문 내역에는 주문 시점의 정보가 유지됩니다.

### 재고 확인 및 차감

주문 시 다음 동작이 보장되어야 합니다.

1. **재고 확인**: 주문 요청된 각 상품의 재고가 충분한지 확인합니다.
2. **재고 차감**: 재고가 충분한 경우 주문 수량만큼 재고를 차감합니다.
3. **원자성 보장**: 여러 상품을 한 번에 주문하므로, 일부 상품의 재고가 부족하면 전체 주문이 실패해야 합니다.

### 결제

결제 기능은 과정 진행 중 추가로 개발됩니다.
초기 구현에서는 주문 생성과 재고 차감까지만 처리하고, 결제 로직은 이후에 확장합니다.

## 요구사항 작성 시 고려 사항

| 항목 | 고려할 내용 |
|------|-------------|
| 동시성 제어 | 동일 상품에 여러 사용자가 동시에 주문할 때 재고 정합성 보장 방법 |
| 주문 상태 | 주문 생성 시 초기 상태 정의 (예: ORDERED, PENDING 등) |
| 스냅샷 범위 | 상품의 어떤 정보까지 스냅샷으로 저장할지 (상품명, 가격, 브랜드명 등) |
| 재고 부족 시 응답 | 어떤 상품의 재고가 부족한지 상세 에러 메시지 제공 여부 |
| 조회 기간 제한 | startAt/endAt 간 최대 조회 기간 제한 여부 |
| 주문 취소 | 주문 취소 기능의 포함 여부 및 재고 복원 처리 |
