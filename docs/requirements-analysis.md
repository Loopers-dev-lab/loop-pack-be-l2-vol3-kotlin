# Round 2 — 이커머스 도메인 설계 요구사항

## 배경

**좋아요** 누르고, **쿠폰** 쓰고, 주문 및 **결제**하는 **감성 이커머스**.

내가 좋아하는 브랜드의 상품들을 한 번에 담아 주문하고, 유저 행동은 랭킹과 추천으로 연결된다.

---

## 서비스 흐름

1. 사용자가 **회원가입**을 하고
2. 여러 브랜드의 상품을 둘러보고, 마음에 드는 상품엔 **좋아요**를 누른다.
3. 사용자는 **쿠폰을 발급**받고, 여러 상품을 **한 번에 주문하고 결제**한다.
4. 유저의 행동은 모두 기록되고, 그 데이터는 이후 다양한 기능으로 확장될 수 있다.

---

## API 공통 규칙

### 대고객 API (`/api/v1`)

유저 로그인이 필요한 기능은 아래 헤더를 통해 유저를 식별한다.
인증/인가는 주요 스코프가 아니므로 구현하지 않는다.
유저는 타 유저의 정보에 직접 접근할 수 없다.

| 헤더                  | 설명     |
|---------------------|--------|
| `X-Loopers-LoginId` | 로그인 ID |
| `X-Loopers-LoginPw` | 비밀번호   |

### 어드민 API (`/api-admin/v1`)

어드민 기능은 아래 헤더를 통해 어드민을 식별한다.

| 헤더               | 설명                               |
|------------------|----------------------------------|
| `X-Loopers-Ldap` | `loopers.admin` (LDAP 기반 사내 어드민) |

---

## 도메인별 요구사항

### 1. 유저 (Users) — 1주차 완성 (제외 도메인)

| METHOD | URI                           | 인증 | 설명      |
|--------|-------------------------------|----|---------|
| POST   | `/api/v1/users/sign-up`       | X  | 회원가입    |
| GET    | `/api/v1/users/user`          | O  | 내 정보 조회 |
| PATCH  | `/api/v1/users/user/password` | O  | 비밀번호 변경 |

---

### 2. 브랜드 & 상품 (Brands / Products)

#### 대고객 API

| METHOD | URI                            | 인증 | 설명        |
|--------|--------------------------------|----|-----------|
| GET    | `/api/v1/brands/{brandId}`     | X  | 브랜드 정보 조회 |
| GET    | `/api/v1/products`             | X  | 상품 목록 조회  |
| GET    | `/api/v1/products/{productId}` | X  | 상품 정보 조회  |

**상품 목록 조회 쿼리 파라미터:**

| 파라미터      | 예시                                    | 설명                            |
|-----------|---------------------------------------|-------------------------------|
| `brandId` | `1`                                   | 특정 브랜드의 상품만 필터링               |
| `sort`    | `latest` / `price_asc` / `likes_desc` | 정렬 기준 (필수: `latest`, 선택: 나머지) |
| `page`    | `0`                                   | 페이지 번호 (기본값 0)                |
| `size`    | `20`                                  | 페이지당 상품 수 (기본값 20)            |

#### 어드민 API

| METHOD | URI                                                       | LDAP | 설명                         |
|--------|-----------------------------------------------------------|------|----------------------------|
| GET    | `/api-admin/v1/brands?page=0&size=20`                     | O    | 브랜드 목록 조회                  |
| GET    | `/api-admin/v1/brands/{brandId}`                          | O    | 브랜드 상세 조회                  |
| POST   | `/api-admin/v1/brands`                                    | O    | 브랜드 등록                     |
| PUT    | `/api-admin/v1/brands/{brandId}`                          | O    | 브랜드 정보 수정                  |
| DELETE | `/api-admin/v1/brands/{brandId}`                          | O    | 브랜드 삭제 (해당 브랜드 상품도 삭제)     |
| GET    | `/api-admin/v1/products?page=0&size=20&brandId={brandId}` | O    | 상품 목록 조회                   |
| GET    | `/api-admin/v1/products/{productId}`                      | O    | 상품 상세 조회                   |
| POST   | `/api-admin/v1/products`                                  | O    | 상품 등록 (브랜드는 이미 등록된 것이어야 함) |
| PUT    | `/api-admin/v1/products/{productId}`                      | O    | 상품 정보 수정 (브랜드 변경 불가)       |
| DELETE | `/api-admin/v1/products/{productId}`                      | O    | 상품 삭제                      |

> 고객과 어드민에게 제공되어야 할 상품/브랜드 정보의 차이를 고민할 것.

---

### 3. 좋아요 (Likes)

| METHOD | URI                                  | 인증 | 설명                |
|--------|--------------------------------------|----|-------------------|
| POST   | `/api/v1/products/{productId}/likes` | O  | 상품 좋아요 등록         |
| DELETE | `/api/v1/products/{productId}/likes` | O  | 상품 좋아요 취소         |
| GET    | `/api/v1/users/likes`                | O  | 내가 좋아요 한 상품 목록 조회 |

---

### 4. 주문 (Orders)

#### 대고객 API

| METHOD | URI                                                      | 인증 | 설명           |
|--------|----------------------------------------------------------|----|--------------|
| POST   | `/api/v1/orders`                                         | O  | 주문 요청        |
| GET    | `/api/v1/orders?startedAt=2026-01-31&endedAt=2026-02-10` | O  | 유저의 주문 목록 조회 |
| GET    | `/api/v1/orders/{orderId}`                               | O  | 단일 주문 상세 조회  |

**주문 요청 예시:**

```json
{
  "items": [
    {
      "productId": 1,
      "quantity": 2
    },
    {
      "productId": 3,
      "quantity": 1
    }
  ]
}
```

**주문 시 보장 사항:**

- 주문 정보에는 당시의 상품 정보가 **스냅샷으로 저장**되어야 한다.
- 주문 시 **상품 재고 확인 및 차감**이 보장되어야 한다.
- **결제**는 추후 추가 개발 예정.

#### 어드민 API

| METHOD | URI                                   | LDAP | 설명          |
|--------|---------------------------------------|------|-------------|
| GET    | `/api-admin/v1/orders?page=0&size=20` | O    | 주문 목록 조회    |
| GET    | `/api-admin/v1/orders/{orderId}`      | O    | 단일 주문 상세 조회 |

---

## 설계 범위

- **포함 도메인**: 상품(Product), 브랜드(Brand), 좋아요(Like), 주문(Order)
- **제외 도메인**: 회원(User) — 1주차에 완성됨
- **추후 개발**: 결제(Payment), 쿠폰(Coupon)

---

## 설계 산출물 (docs/design/)

| 파일명                       | 내용                           |
|---------------------------|------------------------------|
| `01-requirements.md`      | 유저 시나리오 기반 기능 정의, 요구사항 명세    |
| `02-sequence-diagrams.md` | 시퀀스 다이어그램 최소 2개 이상 (Mermaid) |
| `03-class-diagram.md`     | 도메인 객체 설계 (클래스 다이어그램)        |
| `04-erd.md`               | 전체 테이블 구조 및 관계 정리 (ERD)      |

---

## 체크리스트

- [ ] 상품/브랜드/좋아요/주문 도메인이 모두 포함되어 있는가?
- [ ] 기능 요구사항이 유저 중심으로 정리되어 있는가?
- [ ] 시퀀스 다이어그램에서 책임 객체가 드러나는가?
- [ ] 클래스 구조가 도메인 설계를 잘 표현하고 있는가?
- [ ] ERD 설계 시 데이터 정합성을 고려하여 구성하였는가?

---

## 향후 과제

> 모든 기능의 동작을 개발한 후에 동시성, 멱등성, 일관성, 느린 조회, 동시 주문 등 실제 서비스에서 발생하는 문제들을 해결하게 된다.
